
#Which factors are connected to stoke incidence?
#source: https://www.kaggle.com/fedesoriano/stroke-prediction-dataset?select=healthcare-dataset-stroke-data.csv
stroke_data<-read.csv(file='healthcare-dataset-stroke-data.csv')

#clean the data/ take out rows with "unknown" or "N/A"
stroke_data[stroke_data$id == "N/A"|stroke_data$id == "Unknown",]
stroke_data[stroke_data$gender == "N/A"|stroke_data$gender == "Unknown",]
stroke_data[stroke_data$age == "N/A"|stroke_data$age == "Unknown",]
stroke_data[stroke_data$hypertension == "N/A"|stroke_data$hypertension == "Unknown",]
stroke_data[stroke_data$heart_disease == "N/A"|stroke_data$heart_disease == "Unknown",]
stroke_data[stroke_data$ever_married == "N/A"|stroke_data$ever_married == "Unknown",]
stroke_data[stroke_data$work_type == "N/A"|stroke_data$work_type == "Unknown",]
stroke_data[stroke_data$residence_type == "N/A"|stroke_data$residence_type == "Unknown",]
stroke_data[stroke_data$avg_glucose_level == "N/A"|stroke_data$avg_glucose_level == "Unknown",]
stroke_data[stroke_data$bmi == "N/A"|stroke_data$bmi== "Unknown",]
stroke_data[stroke_data$smoking_status == "N/A"|stroke_data$smoking_status == "Unknown",]
stroke_data[stroke_data$stroke == "N/A"|stroke_data$stroke == "Unknown",]
stroke_data_revised<-stroke_data[stroke_data$bmi != "N/A"& 
        stroke_data$id != "Unknown" & stroke_data$smoking_status != "N/A"
                                 & stroke_data$smoking_status != "Unknown",]

#rename the rows to be consectutive again
rownames(stroke_data_revised)<-seq(1:nrow(stroke_data_revised))

#convert the bmi data from character to numerical
stroke_data_revised$bmi<-as.numeric(stroke_data_revised$bmi)

#combined "formerly smoked" and "smokes" variable to "history of smoking"
smoking_history<-stroke_data_revised$smoking_status
smoking_history[smoking_history=="formerly smoked"|
                  smoking_history=="smokes"]<-"history of smoking"  
stroke_data_revised$smoking_history<-smoking_history

#split data into two categories: individuals who had strokes to those who did not
had_stroke<-stroke_data_revised[stroke_data_revised$stroke == 1,]
no_stroke<-stroke_data_revised[stroke_data_revised$stroke == 0,]

#number of individuals who had stroke and smoked vs. never smoked
had_stroke_neversmoked<-nrow(had_stroke[had_stroke$
                                          smoking_history == "never smoked",])
had_stroke_history_of_smoking<-nrow(had_stroke
                                    [had_stroke$smoking_history== "history of smoking",])

#number of individuals who did not have a stroke and smoked vs. never smoked
no_stroke_neversmoked<-nrow(no_stroke[no_stroke$smoking_history == "never smoked",])
no_stroke_history_of_smoking<-nrow(no_stroke
                                   [no_stroke$smoking_history== "history of smoking",])

#prop table for smoking history factor
no_smoke_vs_history_of_smoking<-c(had_stroke_neversmoked, had_stroke_history_of_smoking,
                                  no_stroke_neversmoked, no_stroke_history_of_smoking)
matrix_no_smoke_vs_history_of_smoking<-matrix(no_smoke_vs_history_of_smoking, nrow=2, ncol=2,
                                              byrow=TRUE)
dimnames(matrix_no_smoke_vs_history_of_smoking)<-list(c("Stroke", "No Stroke"), 
                                                      c("Never Smoked", "History of Smoking"))
prop.table(matrix_no_smoke_vs_history_of_smoking,1)

#bar graph for smoking history factor
barplot(t(prop.table(matrix_no_smoke_vs_history_of_smoking,1)), beside=TRUE,
        col=c("gray", "red"), main="Probability of Smoking Status", ylab="Probability", 
        ylim=c(0,.6))
legend(x="topright", legend=c("Never Smoked", "History of Smoking"), 
       col=c("gray", "red"), lwd=10)

#Individuals who have a stroke are more slightly more likely to have a history of smoking.
#Individuals who have not had a stroke are slightly more likely to have never smoked than smoked. 
#From this data we can infer that there is a connection between smoking and having a stroke.  


#Probability an individual had a stroke based on smoking history
prop.table(matrix_no_smoke_vs_history_of_smoking,2)


#boxplot for average glucose level
average_glucose_level<-stroke_data_revised$avg_glucose_level
average_glucose_stroke<-had_stroke$avg_glucose_level
average_glucose_no_stroke<-no_stroke$avg_glucose_level
boxplot(average_glucose_stroke,average_glucose_no_stroke,
        names=c("Stroke", "No Stroke"), 
        col=c("dark green","blue"), main= "Average Glucose Levels",
        ylab="Average Glucose Levels")


#Five number summary for average glucose level
data_avg_glu_levels<-c(fivenum(average_glucose_level), mean(average_glucose_level),
                       fivenum(average_glucose_stroke), mean(average_glucose_stroke),
                       fivenum(average_glucose_no_stroke), mean(average_glucose_no_stroke))
matrix_data_avg_glu_levels<-matrix(data_avg_glu_levels, nrow=3, ncol=6, byrow=TRUE)
dimnames(matrix_data_avg_glu_levels)<-list(c("Total", "Stroke", "No Stroke"), 
                                           c("Min", "1st Qu.", "Median", "3rd Qu.", "Max", "Mean"))
matrix_data_avg_glu_levels

#histogram comparison of average glucose level
par(mfrow=c(2,2))
hist(average_glucose_level, main="Total Sample", xlab="Average Glucose Levels",
     ylim=c(0,.02), prob=TRUE)
hist(average_glucose_stroke, main="Stroke", xlab="Average Glucose Levels",
     ylim=c(0,.02), prob=TRUE)
hist(average_glucose_no_stroke, main="No Stroke", xlab="Average Glucose Levels",
     ylim=c(0,.02), prob=TRUE)

#Having a higher average glucose level and stroke occurrence are connected
#However, individuals who have lower average glucose levels are still having strokes


#BMI vs. age for individuals who have had strokes
no_stroke_bmi<-no_stroke$bmi
groups.weight<-ifelse(had_stroke_bmi < 18.5, "Underweight",
                      ifelse (had_stroke_bmi >=18.5 & had_stroke_bmi < 25, "Healthy Weight",
                              ifelse (had_stroke_bmi>=25 & had_stroke_bmi < 30, "Overweight",
                                      "Obese")))
had_stroke_bmi<-had_stroke$bmi
groups.weight1<-ifelse(no_stroke_bmi < 18.5, "Underweight",
                      ifelse (no_stroke_bmi>=18.5 & no_stroke_bmi < 25, "Healthy Weight",
                              ifelse (no_stroke_bmi>=25 & no_stroke_bmi < 30, "Overweight",
                                      "Obese")))
library(ggplot2)


bmi_age_stroke_plot<-ggplot(had_stroke[,c("bmi","age")], mapping=aes(x=bmi, y=age))+
  geom_point(aes(color=(groups.weight)))+stat_smooth(se=FALSE,method=lm,
                                                     formula= y~x)+
  labs(title="Age vs. BMI for People Who Have Had Strokes")
bmi_age_stroke_plot

#Correlation for data 
cor(had_stroke$age, had_stroke$bmi)

#BMI vs. age for individuals who have not had strokes
bmi_age_no_stroke_plot<-ggplot(no_stroke[,c("bmi","age")], mapping=aes(x=bmi, y=age))+
  geom_point(aes(color=(groups.weight1)))+
  labs(title="Age vs. BMI for People Who Have Not Had Strokes")+
  stat_smooth(se=FALSE,method=lm, formula= y~x)
bmi_age_no_stroke_plot

#Correlation for data 
cor(no_stroke$age, no_stroke$bmi)

#There is little to no relationship between age and BMI for individuals who have had a stroke.
#There is no relationship between the two for individuals who have not had a stroke.  

#Prop table to compare hypertension, heart disease and stroke data numbers
attach(stroke_data_revised)
ftable(table(hypertension,heart_disease, stroke))


#Prop table to compare hypertension, heart disease and stroke data percentages
prop.table(ftable(table(hypertension,heart_disease, stroke)),1)
detach(stroke_data_revised)

#There is some connection between hypertension, heart disease and having a stroke 
#The connection to stroke is stronger if an individual has both heart disease and hypertension as opposed to one or the other. 


